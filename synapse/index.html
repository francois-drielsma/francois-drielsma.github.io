<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SynAPSE: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="SynAPSE_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SynAPSE
   &#160;<span id="projectnumber">0.5.3</span>
   </div>
   <div id="projectbrief">Synergistic Analysis of Phase Space Evolution</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SynAPSE Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Synergistic Analysis of Phase Space Evolution (<b>SynAPSE</b>) provides support for a broad array of particle beam phase space characterization methods. </p>
<hr/>
 <hr/>
<h1>Installation</h1>
<h2>Prerequisites</h2>
<p>The following are required to build the SynAPSE framework:</p>
<ul>
<li>GCC 4.6.4 and above (C++11);</li>
<li>CMake 2.8.0 and above;</li>
<li>ROOT 5.34/36 and above.</li>
</ul>
<p>The following are provided with the SynAPSE framework:</p>
<ul>
<li><a href="http://www.qhull.org/">Qhull</a> 2015.2;</li>
<li><a href="https://github.com/jlblancoc/nanoflann/releases">NanoFLANN</a> 1.2.3.</li>
</ul>
<p>The following is optional but required to import MAUS data:</p>
<ul>
<li><a href="https://launchpad.net/maus">MAUS</a> 2.8.3 and above.</li>
</ul>
<hr/>
<h2>Build</h2>
<p>First, if you want to import MAUS data, source the MAUS environment </p>
<pre class="fragment">source ${MAUS_ROOT_DIR}/env.sh
</pre><p>If it is not included, the MAUS importers will not be built but the rest of the code will work fine.</p>
<p>To build this code, simply run the all purpose builder: </p>
<pre class="fragment">./build.sh -j N --use-maus-gcc flag
</pre><p>with N the number of cores you want to build with. Set the flag to '<b>true</b>' if you require to use the MAUS third party gcc to build the code. </p>
<hr/>
 <hr/>
<h1>Presentation</h1>
<h2>Intended use</h2>
<p>This package was developed with the intention of measuring the evolution of the transverse phase space of muons across an absorber in the context of the Muon Ionization Cooling Experiment (MICE). The experiment measures the phase space of individual beam muons before and after passing through the absorber and builds ensembles at the analysis level. <a class="el" href="classBeam.html" title="Holds a beam ensemble at a specific position along the beam line. ">Beam</a> non linearties observed in the magnetic channel motivated the development of non-standard phase space density estimation techniques. Support was added for G4Beamline output in order to broaden the scope of the package.</p>
<p>This code is aimed at measuring and outputting a broad array of beam parameters (thoroughly described in the following), provided with a set phase space coordinate measurements, i.e. <img class="formulaInl" alt="$(x, p_x, y, p_y, p_z)$" src="form_17.png"/>, of a beam.</p>
<p>The framework measures the evolution of those parameters along the beam line and produces summary graphs for each of them.</p>
<p>The package uniquely supports a wide array of non parametric density estimators that may be used to evaluate the probability density functions of the beams in 2D, 4D or 5D phase space. This allows for the unbiased evaluation of beam volumes, local densities and distributions of filamented beams in phase space.</p>
<p>All the algorithms may be found in </p>
<pre class="fragment">bin/
</pre><hr/>
<h2><a class="el" href="classGlobal.html" title="Represents a single global variable and defines the methods to read it. ">Global</a> variables</h2>
<p>The default global variables used by the framework are specified in the ConfiguratioDefaults.txt file. If the variables are changed in the defaults, it will affect all the algorithms.</p>
<p>Each variable may be overridden individually at run time by adding an option to the command line of the form </p>
<pre class="fragment">./program --option0 value0 --option1 value1 ... [datafile.root]
</pre><p>or </p>
<pre class="fragment">./program --option0=value0 --option1=value1 ... [datafile.root]
</pre><p>If the parameter cannot be found in the defaults, it is not known by the SynAPSE framework and the exception handler will throw.</p>
<p>A custom set of cards may be used to overwrite the default by running </p>
<pre class="fragment">./program --configuration_file custom_config.txt [datafile.root]
</pre><p>The list of available cards and their definition may be printed by running using the flag &ndash;help or -h.</p>
<p>Running the program with the option &ndash;verbose or -v will print out the debugging information when the program is ran by rerouting the Pitch::debug to std::out. </p>
<hr/>
<h2>Input</h2>
<p>Currently there are two supported data structure:</p>
<ul>
<li>MAUS ROOT TTree data structure;</li>
<li>G4BL ASCII output structure.</li>
</ul>
<h3>MAUS</h3>
<p>The MAUS output data structure may be imported in three different ways.<br/>
 <a class="el" href="ImportMAUSData_8cc.html" title="Imports the MICE reconstructed data. ">ImportMAUSData.cc</a> is exectuted as follows: </p>
<pre class="fragment">./import_data [options] maus_data.root
</pre><p>It imports the data and the reconstructed simulation in an identical fashion, including the cuts requested in the datacards:</p>
<ul>
<li>Upstream momentum selection;</li>
<li>Track quality, aperture selection;</li>
<li>Particle species slsection.</li>
</ul>
<p>If a the Monte Carlo truth is present, it is recorded for each particle that makes the particle selection cuts.</p>
<p><a class="el" href="ImportMAUSSimulation_8cc.html" title="Imports the MAUS simulation truth standalone. ">ImportMAUSSimulation.cc</a> is exectuted as follows: </p>
<pre class="fragment">./import_sim [options] maus_sim.root
</pre><p>It imports the Monte Carlo truth only and applies the selection criteria to the truth information rather than the digitized information.</p>
<p><a class="el" href="ImportMAUSMinimal_8cc.html" title="Imports the minimal MAUS simulation. ">ImportMAUSMinimal.cc</a> is exectuted as follows: </p>
<pre class="fragment">./import_minimal [options] maus_sim.root
</pre><p>It imports the Monte Carlo truth only and does not apply any selection criteria. This is useful for minimal simulations that e.g. only include virtual planes, fields and an absorber.</p>
<h3>G4Beamline</h3>
<p><a class="el" href="ImportG4BL_8cc.html" title="Imports G4BL ASCII output. ">ImportG4BL.cc</a> is exectuted as follows: </p>
<pre class="fragment">./import_g4bl [options] g4bl_ascii.txt
</pre><p>It imports the G4Beamline simulation truth and does not apply any selection criteria.</p>
<h3>Output</h3>
<p>The output of the importers is a single ROOT file structured as follows</p>
<ul>
<li>One TNtuple (Data) that contains the real MICE data;</li>
<li>One TNtuple (RecMC) that contains the reconstructed Monte Carlo (digitized);</li>
<li>One TNtuple (Truth) that contains the Monte Carlo truth information corresponding to RecMC;</li>
<li>One TNtuple (UncutTruth) that contains the uncut Monte Carlo truth information;</li>
<li>Additional variables depending on the input (e.g. MAUS version).</li>
</ul>
<p>The Truth and UncutTruth NTuples are structured as follows: </p>
<pre class="fragment">SpillID EventID VirtualPlaneID x y z px py pz
</pre><p>The other two NTuples are structed as follows: </p>
<pre class="fragment">SpillID EventID TrackerID StationID x y z px py pz xe ye ze pxe pye pze
</pre><p>with xe, ye, ... the reconstruction uncertainties on the phase space coordinates.</p>
<p>Any of the four trees may be left empty when filled and the emittance code will proceed accordingly. Specify which data type is requested in the datacards. </p>
<hr/>
<h2>Main algorithms</h2>
<p>All the following algorithms support an identical data structure and are strictly ran on the imported data.</p>
<h3>Phase space</h3>
<p><a class="el" href="PhaseSpace_8cc.html" title="Main phase space density evolution code. ">PhaseSpace.cc</a> is executed as follows </p>
<pre class="fragment">./phase_space [options] import.root
</pre><p>It reconstructs the evolution of several beam phase space summary statistics along the beam line. The parameters include</p>
<ul>
<li>Twiss parameters: &alpha;, &beta; and &gamma;;</li>
<li>mecanical angular momentum <img class="formulaInl" alt="$L$" src="form_3.png"/>;</li>
<li>normalised transverse emittance <img class="formulaInl" alt="$\epsilon_\perp$" src="form_21.png"/>;</li>
<li>transmission;</li>
<li>mean total momentum;</li>
<li>&alpha;-amplitude <img class="formulaInl" alt="$A_\alpha$" src="form_24.png"/>;</li>
<li>&alpha;-subemittance <img class="formulaInl" alt="$e_\alpha$" src="form_22.png"/>;</li>
<li>&alpha;-fractional emittance <img class="formulaInl" alt="$\epsilon_\alpha$" src="form_23.png"/>.</li>
</ul>
<p>All the quantities are provided with a measurement uncertainty (if the data has been reconstructed) and a statistical uncertainty. The quantities are computed and compiled in a single <a class="el" href="classBeam.html" title="Holds a beam ensemble at a specific position along the beam line. ">Beam</a> class built for each <img class="formulaInl" alt="$z$" src="form_20.png"/> position at which the beam is sampled.</p>
<p>If the '<b>mice</b>' flag is set to 1 in the datacards, the default MICE beam line elements will be drawn on the canvases along with a information box that specifies the MAUS version, the ISIS user cycle, the run number and the data type.</p>
<p>If the '<b>de</b>' flag is set to 1 in the datacards, the fractional emittance is reconstructed using non parametric density estimation. The evolution graphs are compiled in a single folder of the name of the input file.</p>
<p>The other datacards that apply to the algorithm are defined as</p>
<ul>
<li>'<b>frac</b>' specifies the fraction of the beam considered in the fractional quantities;</li>
<li>'<b>min_vid</b>' ID of the first virtual plane to draw;</li>
<li>'<b>tku_vid</b>' ID of the upstream reference virtual plane;</li>
<li>'<b>tkd_vid</b>' ID of the downstream reference virtual plane;</li>
<li>'<b>max_vid</b>' ID of the last virtual plane to draw</li>
</ul>
<p>For a definition of &alpha;-amplitude, subemittance and fractional emittance, see <a href="https://pos.sissa.it/295/099/">https://pos.sissa.it/295/099/</a>.</p>
<h3>Amplitudes</h3>
<p><a class="el" href="Amplitudes_8cc.html" title="Reconstructs the amplitude distributions of the beam. ">Amplitudes.cc</a> is executed as follows </p>
<pre class="fragment">./amplitudes [options] import.root
</pre><p>It reconstructs the amplitude distribution upstream and downstream of the absorber. If applied to a simulation, it compares the distributions measured at the virtual planes specified by '<b>tku_vid</b>' and '<b>tkd_vid</b>' in the datacards.</p>
<p>A series of flags are available in the datcards:</p>
<ul>
<li>'<b>corrected</b>' computes the amplitudes by recursively removing high amplitudes;</li>
<li>'<b>mcd</b>' computes the amplitudes based on the MCD covariance matrix;</li>
<li>'<b>generalised</b>' uses non parametric density estimation to produce amplitudes;</li>
<li>'<b>significance</b>' computes the significance of the difference between each amplitude bin;</li>
<li>'<b>rebin</b>' bins the data in buckets of equal phase space volume;</li>
<li>'<b>poincare</b>' produces Poincare sections of the phase space.</li>
</ul>
<p>If the flag '<b>voronoi</b>' is true, the distribution of <a class="el" href="classVoronoi.html" title="Computes the Voronoi tessellation of a set of points. ">Voronoi</a> tesselation cell volumes is reconstructed upstream and downstream of the absorber. It is time intensive in four dimensions. </p>
<hr/>
<h2>Tools</h2>
<hr/>
<h2>Toy Monte Carlo</h2>
<hr/>
<h2>Backend packages</h2>
<h3>Exception handler</h3>
<p>Propriatary exception handling and output stream</p>
<ul>
<li>Produces an accurate description of any exceptions (<a class="el" href="namespaceExceptions.html" title="Environment of custom exceptions to be thrown by the code. ">Exceptions</a>);</li>
<li>Redirects the output stream of different classes of messages (<a class="el" href="classPitch.html" title="Redirect output to std::out, std::cerr or file depending on severity. ">Pitch</a>).</li>
</ul>
<h3>Mathematics package</h3>
<p>The mathematics package includes</p>
<ul>
<li>Linear algebra (<a class="el" href="classMatrix.html" title="Object that can host any type of data in an matrix arrangement. ">Matrix</a>, <a class="el" href="classVector.html" title="Object that can host any type of data in a vector arrangement. ">Vector</a>, <a class="el" href="classDecompLU.html" title="Defines the LU decomposition algorithm of a square matrix. ">DecompLU</a>, <a class="el" href="classDecompQR.html" title="Defines the QR decomposition algorithm of a square matrix. ">DecompQR</a>);</li>
<li>Computational geometry package (<a class="el" href="Geometry_8hh.html" title="Set of functions that compose the Geometry package. ">Geometry.hh</a>);</li>
<li>Statistics package (<a class="el" href="Statistics_8hh.html" title="Set of functions that compose the Statistics package. ">Statistics.hh</a>);</li>
<li>Broad set of n-dimensional distribution types (Gaus, Exponential, Uniform, etc.)</li>
</ul>
<h3>Density estimation package</h3>
<p>Density estimation package</p>
<ul>
<li>Broad array of non parametric density estimators:<ul>
<li>Delaunary Tesselation Field Estimator (<a class="el" href="classDTFE.html" title="Computes the Delaunay Tesselation Field Estimator (DTFE) of a set of points. ">DTFE</a>);</li>
<li>Kernel Density Esimator (<a class="el" href="classKDE.html" title="Computes the Kernel Density Estimator (KDE) of a set of points. ">KDE</a>);</li>
<li>k-Neareast Neighbour density estimator (<a class="el" href="classKNearestNeighbours.html" title="Computes the k-Nearest Neighbour (kNN) density estimator of a set of points. ">KNearestNeighbours</a>);</li>
<li>Local Reachability density estimator (<a class="el" href="classLocalReachability.html" title="Computes the Local Reachability density estimator of a set of points. ">LocalReachability</a>);</li>
<li>Optimal binning density estimator (<a class="el" href="classOptimalBinning.html" title="Computes the Optimal Binning density estimator of a set of points. ">OptimalBinning</a>);</li>
<li>Tesselation Density Estimator (<a class="el" href="classTDE.html" title="Computes the Tesselation Density Estimator (TDE) of a set of points. ">TDE</a>);</li>
<li>Penalised Bootstrap Aggregate Tesselation Denisty Estimator (<a class="el" href="classPBATDE.html" title="Computes the Penalised Bootstrap Aggregate Tesselation Density Estimator (PBATDE) of a set of points...">PBATDE</a>).</li>
</ul>
</li>
<li>Support for computational geometric methods to support the estimators<ul>
<li><a class="el" href="classDelaunay.html" title="Computes the Delaunay triangulation of a set of points. ">Delaunay</a> triangulation (<a class="el" href="classDelaunay.html" title="Computes the Delaunay triangulation of a set of points. ">Delaunay</a>);</li>
<li><a class="el" href="classVoronoi.html" title="Computes the Voronoi tessellation of a set of points. ">Voronoi</a> tesselation (<a class="el" href="classVoronoi.html" title="Computes the Voronoi tessellation of a set of points. ">Voronoi</a>);</li>
<li>Alpha-complicies (<a class="el" href="classAlphaComplex.html" title="Computes the α-complex of a set of points. ">AlphaComplex</a>).</li>
</ul>
</li>
<li>Interpolators to fill the gaps between discrete estimates<ul>
<li>n-linear interpolator (<a class="el" href="classLinearInterpolator.html" title="Performs the linear interpolation between discrete samples of a scalar field organised on an n-orthot...">LinearInterpolator</a>);</li>
<li>simplical interpolator (<a class="el" href="classSimplexInterpolator.html" title="Performs the simplical interplation between n+1 discrete samples in n dimensions. ...">SimplexInterpolator</a>).</li>
</ul>
</li>
</ul>
<hr/>
 <hr/>
<h1>Latest version updates</h1>
<p>Version <b>0.5.3</b></p>
<ul>
<li>Added an data extractor (<a class="el" href="classExtractor.html" title="Extracts the data from an array of imported ROOT file. ">Extractor</a>)</li>
<li>Added a drawing assistant (Drawer) to replace the old plotting tools</li>
<li>Optimized the amplitude algorithm (<a class="el" href="Amplitudes_8cc.html" title="Reconstructs the amplitude distributions of the beam. ">Amplitudes.cc</a>)</li>
<li>Optimized the profile algorithm (<a class="el" href="Profiles_8cc.html" title="Produces phase space profiles. ">Profiles.cc</a>)</li>
<li>Does not compute the measurement uncertainties by default (<a class="el" href="classBeam.html" title="Holds a beam ensemble at a specific position along the beam line. ">Beam</a>)</li>
<li>Fixed the spiral function, now fully supported (<a class="el" href="classDSpiral.html" title="Defines the methods associated with the Spiral distribution in any dimension. ">DSpiral</a>)</li>
<li>Added verbosity option for the progress bar (<a class="el" href="classProgressBar.html" title="Provides a progess bar to be included in a for loop. ">ProgressBar</a>)</li>
<li>Bug fixes</li>
</ul>
<p>Version <b>0.5.2</b></p>
<ul>
<li>Optimized reweighting algorithm (<a class="el" href="ReweightBeam_8cc.html" title="Reweights the MAUS simulation to reproduce the amplitude distribution observed in data...">ReweightBeam.cc</a>)</li>
<li>Added tool to draw data-sim comparisons (<a class="el" href="PlotTools_8hh.html" title="ROOT plotting tools. ">PlotTools.hh</a>)</li>
<li>Bug fixes</li>
</ul>
<p>Version <b>0.5.1</b>:</p>
<ul>
<li>Added the default data cards (may be overridden)</li>
<li>Added support for custom data cards</li>
<li>Added support for command line arguments</li>
<li>Bug fixes</li>
</ul>
<p>Version <b>0.5.0</b>:</p>
<ul>
<li>First Doxygen documentation</li>
<li><a class="el" href="classBeam.html" title="Holds a beam ensemble at a specific position along the beam line. ">Beam</a> data importers</li>
<li><a class="el" href="classBeam.html" title="Holds a beam ensemble at a specific position along the beam line. ">Beam</a> data structure and methods</li>
<li>Toy monte carlo package</li>
<li>Propriatary exception handling and output stream</li>
<li>Mathematics package</li>
<li>Density estimation package</li>
<li><a class="el" href="classGlobal.html" title="Represents a single global variable and defines the methods to read it. ">Global</a> variables handler</li>
<li>Geometry handler</li>
<li><a class="el" href="classBeam.html" title="Holds a beam ensemble at a specific position along the beam line. ">Beam</a> line aperture handler</li>
<li><a class="el" href="classBeam.html" title="Holds a beam ensemble at a specific position along the beam line. ">Beam</a> plotting tools </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 23 2018 20:35:06 for SynAPSE by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
